---
title: "Hedge pricing"
code-fold: true
---

## Calculate implied volatility

First we have to extract nifty data using `tidyquant` or `Rquantlib`.

```{r message=FALSE}

# Install necessary packages if not already installed

# install.packages("quantmod")
# install.packages("RQuantLib")


# Load necessary packages

library(data.table)
library(tidyquant)

# Fetch the Nifty 50 index data
nifty_data <- tq_get("^NSEI", from = "1980-01-01", to = Sys.Date())

# Convert the data to a data.table
nifty_data <- data.table(nifty_data)
```

### Get closing price

```{r}
# Extract the last closing price directly from nifty_data
closing_price <- tail(nifty_data$close, 1)
closing_price
```

### Implied Volatility calculation

Plugin the latest option price for a liquid strike price with a 4 month maturity to get a reasonably accurate implied volatility.

```{r}

library(quantmod)
library(RQuantLib)

# Define option parameters for a single observation
nifty_price<-22530
option_price <- 127  # Current market price of the option
strike_price <- 20000  # Strike price of the option
time_to_expiry <- 120/365  # Time to expiration in years
risk_free_rate <- 0.071   # Risk-free interest rate
volatility_guess <- 0.2  # Initial guess for the volatility

# Calculate implied volatility for a put option

vol<- EuropeanOptionImpliedVolatility(type = "put",value =option_price ,underlying = nifty_price,strike = strike_price,dividendYield = 0,riskFreeRate = risk_free_rate,maturity = time_to_expiry,volatility = .2)

vol
```

At present the **implied volatility is `r round(vol*100)`**

## Option pricing calculation

Aim for a strike **\~10 delta.**

```{r}

closing_price<-closing_price
strike <- closing_price * 0.9  # Strike price of the option
time_to_expiry <- 120/365  # Time to expiration in years
risk_free_rate <- 0.071   # Risk-free interest rate


price<-EuropeanOption(type = "put",underlying = closing_price,strike = strike,dividendYield = 0,riskFreeRate = risk_free_rate,maturity = time_to_expiry,volatility = vol)

cat("Closing price of nifty:\n")

print(closing_price)

cat("Strike price:\n")

strike

```

Price of a **4 month 12 delta option** is `r round(price$value)` for the given strike price
