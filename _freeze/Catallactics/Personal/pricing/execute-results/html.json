{
  "hash": "658fac2b793c8e8186bde60d70d78f49",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hedge pricing\"\ndate: today\ncode-fold: true\n---\n\n\n\n\n## Calculate implied volatility\n\nFirst we have to extract nifty data using `tidyquant` or `Rquantlib`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install necessary packages if not already installed\n\n# install.packages(\"quantmod\")\n# install.packages(\"RQuantLib\")\n\n\n# Load necessary packages\n\nlibrary(data.table)\nlibrary(tidyquant)\n\n# Fetch the Nifty 50 index data\nnifty_data <- tq_get(\"^NSEI\", from = \"1980-01-01\", to = Sys.Date())\n\n# Convert the data to a data.table\nnifty_data <- data.table(nifty_data)\n```\n:::\n\n\n\n\n### Get closing price\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract the last closing price directly from nifty_data\nclosing_price <- tail(nifty_data$close, 1)\nclosing_price\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 24768.3\n```\n\n\n:::\n:::\n\n\n\n\n### Implied Volatility calculation\n\nPlugin the latest option price for a liquid strike price with a 4 month maturity to get a reasonably accurate implied volatility.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(quantmod)\nlibrary(RQuantLib)\n\n# Define option parameters for a single observation\nnifty_price<-23290.5\noption_price <- 105  # Current market price of the option\nstrike_price <- 22500  # Strike price of the option\ntime_to_expiry <- 19/365  # Time to expiration in years\nrisk_free_rate <- 0.071   # Risk-free interest rate\nvolatility_guess <- 0.2  # Initial guess for the volatility\n\n# Calculate implied volatility for a put option\n\nvol<- EuropeanOptionImpliedVolatility(type = \"put\",value =option_price ,underlying = nifty_price,strike = strike_price,dividendYield = 0,riskFreeRate = risk_free_rate,maturity = time_to_expiry,volatility = .2)\n\nvol\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1903814\nattr(,\"class\")\n[1] \"EuropeanOptionImpliedVolatility\" \"ImpliedVolatility\"              \n```\n\n\n:::\n:::\n\n\n\n\nAt present the **implied volatility is 19**\n\n## Option pricing calculation\n\nAim for a strike **less than 10 delta.** Plugin the **implied volatility** and other data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclosing_price<-23389\nstrike <- closing_price * 0.85  # Strike price of the option\ntime_to_expiry <- 210/365  # Time to expiration in years\nrisk_free_rate <- 0.071   # Risk-free interest rate\n\n\nprice<-EuropeanOption(type = \"put\",underlying = closing_price,strike = strike,dividendYield = 0,riskFreeRate = risk_free_rate,maturity = time_to_expiry,volatility = vol)\n\ncat(\"Closing price of nifty:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClosing price of nifty:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(closing_price)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 23389\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Strike price:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStrike price:\n```\n\n\n:::\n\n```{.r .cell-code}\nstrike\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 19880.65\n```\n\n\n:::\n\n```{.r .cell-code}\nprice\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConcise summary of valuation for EuropeanOption \n    value     delta     gamma      vega     theta       rho    divRho \n 109.5493   -0.0693    0.0000 2363.9846 -268.4321 -995.5055  932.5147 \n```\n\n\n:::\n:::\n\n\n\n\nPrice of a **4 month 5 delta option** is 110 for the given strike price\n\n## Take home message\n\n::: callout-note\n### Summary\n\nBefore buying hedge, plugin the market price, strike price, time to maturity, implied volatility and risk free rate to the BS formula and find out the fair value. Then only buy the hedge.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclosing<-21884.9\nstrikerate <- 20000  # Strike price of the option\ntime<- 210/365  # Time to expiration in years\nrisk_free_rate <- 0.071   # Risk-free interest rate\nvol<-vol # implied volatility\n\nprice<-EuropeanOption(type = \"put\",underlying = closing,strike = strikerate,dividendYield = 0,riskFreeRate = risk_free_rate,maturity = time,volatility = vol)\nprice\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConcise summary of valuation for EuropeanOption \n     value      delta      gamma       vega      theta        rho     divRho \n  293.1177    -0.1638     0.0001  4100.4435  -403.4529 -2230.1221  2061.5794 \n```\n\n\n:::\n\n```{.r .cell-code}\nstrikerate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 20000\n```\n\n\n:::\n:::\n\n\n\n\n## **Monetising the hedge**\n\n**§a** passive - at the time of expiry.\n\n**§b** Empirical multiples of Initial cost. \n\n**§a** is ideal for long time horizon with potential big drawdown happening once or twice. **§b** out performs **§a** if no such tail events occur. In such a situation, even no-hedge strategy performs better than one with a hedge. \n\nFor the hedging to outperform a pure buy and hold strategy with out hedging, it should be monitised at 8- 10 times the initial premium or a catastrophy should happen. In any case, the proceedings should be used to buy further far OTM puts and rest may be invested in the crashing asset.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}